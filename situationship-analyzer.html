<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíï Situationship Analyzer üíï</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24, #ff4757, #ff3838);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Floating hearts animation */
        .hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .heart {
            position: absolute;
            font-size: 20px;
            color: rgba(255, 255, 255, 0.3);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header h1 {
            font-size: 3.5rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.9);
            font-style: italic;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
            animation: slideUp 1s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #ff4757;
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ffd8d8;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #ff4757;
            box-shadow: 0 0 15px rgba(255, 71, 87, 0.3);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: linear-gradient(45deg, #ff4757, #ff6b6b);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }

        .file-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 71, 87, 0.3);
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .tag {
            background: linear-gradient(45deg, #ff4757, #ff6b6b);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            animation: tagAppear 0.3s ease-out;
        }

        @keyframes tagAppear {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #fff5f5;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: #ffe8e8;
            transform: translateX(5px);
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #ff4757;
        }

        .analyze-btn {
            background: linear-gradient(45deg, #ff4757, #ff6b6b);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            position: relative;
            overflow: hidden;
        }

        .analyze-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(255, 71, 87, 0.4);
        }

        .analyze-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .analyze-btn:hover::before {
            left: 100%;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff4757;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            animation: slideUp 1s ease-out;
        }

        .metric-card {
            background: linear-gradient(135deg, #fff5f5, #ffe8e8);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #ff4757;
            animation: cardAppear 0.5s ease-out;
        }

        @keyframes cardAppear {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .metric-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ff4757;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ff6b6b);
            border-radius: 10px;
            transition: width 1s ease-out;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .quote-section {
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-style: italic;
            font-size: 1.2rem;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 71, 87, 0.3); }
            to { box-shadow: 0 0 30px rgba(255, 71, 87, 0.6); }
        }

        .analysis-section {
            margin: 20px 0;
        }

        .analysis-section h4 {
            color: #ff4757;
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-content {
            background: #fff5f5;
            padding: 20px;
            border-radius: 10px;
            line-height: 1.6;
        }

        .advice-section {
            background: linear-gradient(135deg, #ffe8e8, #fff5f5);
            border: 2px solid #ff4757;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .advice-section h4 {
            color: #ff4757;
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .advice-list {
            list-style: none;
            padding: 0;
        }

        .advice-list li {
            padding: 10px 0;
            border-bottom: 1px solid #ffe8e8;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .advice-list li:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .form-container, .results {
                padding: 20px;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="hearts" id="hearts"></div>
    
    <div class="container">
        <div class="header">
            <h1>üíï Situationship Analyzer üíï</h1>
            <p>Decode the mysteries of your relationship through AI-powered analysis</p>
        </div>

        <div class="form-container">
            <form id="analyzerForm">
                <div class="form-section">
                    <h3>üì± Chat Logs</h3>
                    <div class="form-group">
                        <label for="chatLogs">Paste your chat logs here:</label>
                        <textarea id="chatLogs" name="chatLogs" placeholder="Paste your conversation here..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Or upload a text file:</label>
                        <div class="file-upload">
                            <input type="file" id="chatFile" accept=".txt" onchange="handleFileUpload(event)">
                            <span>üìé Choose File</span>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üíñ How much do you like this person?</h3>
                    <div class="form-group">
                        <select id="likeLevel" name="likeLevel">
                            <option value="">Select your feelings...</option>
                            <option value="1">1 - Barely know them</option>
                            <option value="2">2 - Casual acquaintance</option>
                            <option value="3">3 - Friendly</option>
                            <option value="4">4 - Good friends</option>
                            <option value="5">5 - Close friends</option>
                            <option value="6">6 - Crush territory</option>
                            <option value="7">7 - Definitely interested</option>
                            <option value="8">8 - Strong feelings</option>
                            <option value="9">9 - Falling in love</option>
                            <option value="10">10 - Head over heels</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>‚úÖ Pros</h3>
                    <div class="form-group">
                        <input type="text" id="proInput" placeholder="Add a pro (e.g., great sense of humor)">
                        <button type="button" onclick="addTag('pros', 'proInput')" style="margin-top: 10px; padding: 8px 16px; background: #ff4757; color: white; border: none; border-radius: 5px; cursor: pointer;">Add Pro</button>
                        <div id="prosTags" class="tags-container"></div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>‚ùå Cons</h3>
                    <div class="form-group">
                        <input type="text" id="conInput" placeholder="Add a con (e.g., inconsistent communication)">
                        <button type="button" onclick="addTag('cons', 'conInput')" style="margin-top: 10px; padding: 8px 16px; background: #ff4757; color: white; border: none; border-radius: 5px; cursor: pointer;">Add Con</button>
                        <div id="consTags" class="tags-container"></div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üå∂Ô∏è Spice Level (1-10)</h3>
                    <div class="form-group">
                        <select id="spiceLevel" name="spiceLevel">
                            <option value="">Select spice level...</option>
                            <option value="1">1 - Sweet and innocent</option>
                            <option value="2">2 - Slightly flirty</option>
                            <option value="3">3 - Playful banter</option>
                            <option value="4">4 - Moderate spice</option>
                            <option value="5">5 - Balanced heat</option>
                            <option value="6">6 - Getting steamy</option>
                            <option value="7">7 - Hot and heavy</option>
                            <option value="8">8 - Very spicy</option>
                            <option value="9">9 - Extremely hot</option>
                            <option value="10">10 - üî•üî•üî•</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üí≠ Thoughts about the person</h3>
                    <div class="form-group">
                        <select id="thoughts" name="thoughts">
                            <option value="">Select your thoughts...</option>
                            <option value="romantic">üíï Romantic feelings</option>
                            <option value="platonic">ü§ù Platonic friendship</option>
                            <option value="confused">üòµ‚Äçüí´ Confused about feelings</option>
                            <option value="casual">üòä Casual interest</option>
                            <option value="serious">üíç Serious potential</option>
                            <option value="complicated">üò∞ It's complicated</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üí¨ Communication Styles</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="roasting" name="communicationStyles" value="roasting">
                            <label for="roasting">üî• Roasting</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="flirty" name="communicationStyles" value="flirty">
                            <label for="flirty">üòò Flirty</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="respectful" name="communicationStyles" value="respectful">
                            <label for="respectful">ü§ù Respectful</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="freaky" name="communicationStyles" value="freaky">
                            <label for="freaky">üòà Freaky</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="disrespectful" name="communicationStyles" value="disrespectful">
                            <label for="disrespectful">üò§ Disrespectful</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="futureTalks" name="communicationStyles" value="futureTalks">
                            <label for="futureTalks">üîÆ Future talks</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="loveBombing" name="communicationStyles" value="loveBombing">
                            <label for="loveBombing">üí£ Love bombing</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="oneSideDomination" name="communicationStyles" value="oneSideDomination">
                            <label for="oneSideDomination">üëë One-side domination</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="powerCouple" name="communicationStyles" value="powerCouple">
                            <label for="powerCouple">‚ö° Power couple</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="playful" name="communicationStyles" value="playful">
                            <label for="playful">üéÆ Playful</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="supportive" name="communicationStyles" value="supportive">
                            <label for="supportive">üí™ Supportive</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="mysterious" name="communicationStyles" value="mysterious">
                            <label for="mysterious">üïµÔ∏è Mysterious</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="clingy" name="communicationStyles" value="clingy">
                            <label for="clingy">ü§ó Clingy</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="distant" name="communicationStyles" value="distant">
                            <label for="distant">üåå Distant</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="jealous" name="communicationStyles" value="jealous">
                            <label for="jealous">üò† Jealous</label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üéØ Key Moments Analysis</h3>
                    <div class="form-group">
                        <label>Select which moments you'd like the AI to analyze from your chat logs:</label>
                        <div class="checkbox-group" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                            <div class="checkbox-item">
                                <input type="checkbox" id="keyMoments" name="momentAnalysis" value="keyMoments" checked>
                                <label for="keyMoments">üîë Key Moments (Important turning points)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="funnyMoments" name="momentAnalysis" value="funnyMoments" checked>
                                <label for="funnyMoments">üòÇ Funny Moments (Humor & banter)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="spicyMoments" name="momentAnalysis" value="spicyMoments" checked>
                                <label for="spicyMoments">üå∂Ô∏è Spicy Moments (Flirty & steamy)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="bestFlirty" name="momentAnalysis" value="bestFlirty" checked>
                                <label for="bestFlirty">üíã Best Flirty Moments (Top romantic exchanges)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="emotionalMoments" name="momentAnalysis" value="emotionalMoments">
                                <label for="emotionalMoments">üíù Emotional Moments (Deep conversations)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="conflictMoments" name="momentAnalysis" value="conflictMoments">
                                <label for="conflictMoments">‚öîÔ∏è Conflict Moments (Arguments & disagreements)</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üìÖ Relationship Timeline</h3>
                    <div class="form-group">
                        <label>How long have you been talking/seeing each other?</label>
                        <select id="relationshipDuration" name="relationshipDuration">
                            <option value="">Select duration...</option>
                            <option value="lessThanWeek">Less than a week</option>
                            <option value="fewWeeks">Few weeks</option>
                            <option value="month">About a month</option>
                            <option value="fewMonths">Few months</option>
                            <option value="halfYear">6+ months</option>
                            <option value="year">1+ year</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>How often do you communicate?</label>
                        <select id="communicationFrequency" name="communicationFrequency">
                            <option value="">Select frequency...</option>
                            <option value="daily">Daily</option>
                            <option value="fewTimesWeek">Few times a week</option>
                            <option value="weekly">Weekly</option>
                            <option value="occasionally">Occasionally</option>
                            <option value="rarely">Rarely</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üö© Red Flag Detector</h3>
                    <div class="form-group">
                        <label>Select any concerning behaviors you've noticed:</label>
                        <div class="checkbox-group" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="checkbox-item">
                                <input type="checkbox" id="ghosting" name="redFlags" value="ghosting">
                                <label for="ghosting">üëª Ghosting/Disappearing</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="hotCold" name="redFlags" value="hotCold">
                                <label for="hotCold">üå°Ô∏è Hot & Cold behavior</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="loveBombing" name="redFlags" value="loveBombing">
                                <label for="loveBombing">üí£ Love bombing</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="controlling" name="redFlags" value="controlling">
                                <label for="controlling">üé≠ Controlling behavior</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="disrespectful" name="redFlags" value="disrespectful">
                                <label for="disrespectful">üò§ Disrespectful comments</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="inconsistent" name="redFlags" value="inconsistent">
                                <label for="inconsistent">üîÑ Inconsistent communication</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="jealous" name="redFlags" value="jealous">
                                <label for="jealous">üò† Jealous/possessive</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="avoidant" name="redFlags" value="avoidant">
                                <label for="avoidant">üèÉ Avoidant of serious talks</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="gaslighting" name="redFlags" value="gaslighting">
                                <label for="gaslighting">üí° Gaslighting</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="breadcrumbing" name="redFlags" value="breadcrumbing">
                                <label for="breadcrumbing">üçû Breadcrumbing</label>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="analyze-btn">
                    üîÆ Analyze My Situationship üîÆ
                </button>
            </form>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>üîÆ Analyzing your situationship with AI magic...</p>
        </div>

        <div class="results" id="results"></div>
    </div>

    <script>
        // Floating hearts animation
        function createHearts() {
            const heartsContainer = document.getElementById('hearts');
            const hearts = ['üíï', 'üíñ', 'üíó', 'üíì', 'üíù', 'üíò', 'üíû', 'üíü'];
            
            setInterval(() => {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
                heartsContainer.appendChild(heart);
                
                setTimeout(() => {
                    heart.remove();
                }, 6000);
            }, 300);
        }

        // Tag management
        let pros = [];
        let cons = [];

        function addTag(type, inputId) {
            const input = document.getElementById(inputId);
            const value = input.value.trim();
            
            if (value) {
                if (type === 'pros') {
                    pros.push(value);
                    updateTags('prosTags', pros);
                } else {
                    cons.push(value);
                    updateTags('consTags', cons);
                }
                input.value = '';
            }
        }

        function updateTags(containerId, tags) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            tags.forEach((tag, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${tag}
                    <button onclick="removeTag('${containerId === 'prosTags' ? 'pros' : 'cons'}', ${index})">√ó</button>
                `;
                container.appendChild(tagElement);
            });
        }

        function removeTag(type, index) {
            if (type === 'pros') {
                pros.splice(index, 1);
                updateTags('prosTags', pros);
            } else {
                cons.splice(index, 1);
                updateTags('consTags', cons);
            }
        }

        // File upload handling
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file && file.type === 'text/plain') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('chatLogs').value = e.target.result;
                };
                reader.readAsText(file);
            }
        }

        // Form submission and AI analysis
        document.getElementById('analyzerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                chatLogs: formData.get('chatLogs') || '',
                likeLevel: formData.get('likeLevel') || '',
                spiceLevel: formData.get('spiceLevel') || '',
                thoughts: formData.get('thoughts') || '',
                pros: pros,
                cons: cons,
                communicationStyles: Array.from(document.querySelectorAll('input[name="communicationStyles"]:checked')).map(cb => cb.value),
                momentAnalysis: Array.from(document.querySelectorAll('input[name="momentAnalysis"]:checked')).map(cb => cb.value),
                relationshipDuration: formData.get('relationshipDuration') || '',
                communicationFrequency: formData.get('communicationFrequency') || '',
                redFlags: Array.from(document.querySelectorAll('input[name="redFlags"]:checked')).map(cb => cb.value)
            };

            // Validate that we have some data to analyze
            if (!data.chatLogs.trim() && !data.likeLevel && !data.spiceLevel && !data.thoughts) {
                alert('Please provide at least some chat logs or relationship information for analysis.');
                return;
            }

            console.log('Data being sent to AI:', data);

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';

            try {
                const analysis = await analyzeSituationship(data);
                displayResults(analysis);
            } catch (error) {
                console.error('Analysis failed:', error);
                alert('Analysis failed. Please try again.');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        });

        async function analyzeSituationship(data) {
            const prompt = `
            You are a professional situationship analyst and relationship expert. Analyze the following chat logs and relationship data to provide a unique, personalized analysis.

            CHAT LOGS TO ANALYZE:
            ${data.chatLogs}

            RELATIONSHIP CONTEXT:
            - How much they like the person: ${data.likeLevel}/10
            - Spice level in relationship: ${data.spiceLevel}/10
            - Their thoughts about the person: ${data.thoughts}
            - Pros they see: ${data.pros.join(', ')}
            - Cons they see: ${data.cons.join(', ')}
            - Communication styles observed: ${data.communicationStyles.join(', ')}
            - Moments they want analyzed: ${data.momentAnalysis.join(', ')}
            - Relationship duration: ${data.relationshipDuration}
            - Communication frequency: ${data.communicationFrequency}
            - Red flags observed: ${data.redFlags.join(', ')}

            INSTRUCTIONS:
            1. Study the chat logs carefully and identify patterns, emotions, and dynamics
            2. Provide unique analysis based on the actual conversation content
            3. Extract real quotes from the chat logs for moment analysis
            4. Give personalized advice based on the specific relationship dynamics
            5. Be honest and factual about what you observe in the chat logs

            REQUIRED ANALYSIS:
            1. Healthy Levels (1-100%) - based on communication patterns, respect, boundaries
            2. Spicy Levels (1-100%) - based on flirty/romantic content in chats
            3. Communication Flow Levels (1-100%) - based on conversation quality and engagement
            4. Compatibility Score (1-100%) - based on communication styles, values, and relationship goals
            5. Red Flag Score (1-100%) - based on concerning behaviors and patterns
            6. Future Prediction - realistic assessment of where this could go based on current patterns
            7. A unique romantic quote/poetry inspired by their specific situation
            8. A personalized brief statement analyzing their unique vibe
            9. Detailed analysis in bullet points based on actual chat patterns
            10. Key moments from chat logs (extract actual quotes):
                - Key Moments: Important turning points with actual chat quotes
                - Funny Moments: Humorous exchanges with actual chat quotes
                - Spicy Moments: Flirty/steamy exchanges with actual chat quotes
                - Best Flirty Moments: Top romantic exchanges with actual chat quotes
                - Emotional Moments: Deep conversations with actual chat quotes
                - Conflict Moments: Arguments/disagreements with actual chat quotes
            11. Personalized advice based on their specific situation (provide as an array of advice points)

            IMPORTANT: Base ALL analysis on the actual chat logs provided. If chat logs are empty or insufficient, note this in your analysis. Provide unique insights, not generic responses.

            Format response as JSON with these exact keys: healthyLevel, spicyLevel, communicationLevel, compatibilityScore, redFlagScore, futurePrediction, quote, briefStatement, detailedAnalysis, keyMoments, funnyMoments, spicyMoments, bestFlirtyMoments, emotionalMoments, conflictMoments, advice
            Note: advice should be an array of strings, not a single string.
            `;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyAw_ShPCqm24zDaaIHml0Gbi6M4cPeoo6Q`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }]
                })
            });

            const result = await response.json();
            
            if (result.candidates && result.candidates[0] && result.candidates[0].content) {
                const text = result.candidates[0].content.parts[0].text;
                console.log('AI Response:', text);
                
                try {
                    // Try to extract JSON from the response
                    const jsonMatch = text.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const parsed = JSON.parse(jsonMatch[0]);
                        console.log('Parsed JSON:', parsed);
                        return parsed;
                    } else {
                        // If no JSON found, try to parse the entire text
                        return JSON.parse(text);
                    }
                } catch (error) {
                    console.log('JSON parsing failed, creating structured response');
                    return createStructuredResponse(text, data);
                }
            } else {
                throw new Error('No response from AI');
            }
        }

        function createStructuredResponse(text, data) {
            // Analyze the AI text response to extract insights
            const hasChatLogs = data.chatLogs && data.chatLogs.trim().length > 0;
            const likeLevel = parseInt(data.likeLevel) || 5;
            const spiceLevel = parseInt(data.spiceLevel) || 5;
            
            // Generate dynamic responses based on actual data
            let healthyLevel = 50;
            let spicyLevel = 50;
            let communicationLevel = 50;
            let compatibilityScore = 50;
            let redFlagScore = 0;
            
            if (hasChatLogs) {
                // Adjust levels based on chat content analysis
                const chatLength = data.chatLogs.length;
                const hasEmojis = /üòÄ|üòç|üòò|üòè|üòà|üíï|üíñ|üíã|üå∂Ô∏è|üî•/.test(data.chatLogs);
                const hasQuestions = (data.chatLogs.match(/\?/g) || []).length;
                const hasLongMessages = data.chatLogs.split('\n').filter(line => line.length > 50).length;
                
                if (hasEmojis) spicyLevel += 20;
                if (hasQuestions > 5) communicationLevel += 15;
                if (hasLongMessages > 3) healthyLevel += 15;
                if (chatLength > 1000) communicationLevel += 10;
            }
            
            // Calculate compatibility score based on communication styles
            if (data.communicationStyles.length > 0) {
                const positiveStyles = ['respectful', 'supportive', 'playful', 'flirty', 'powerCouple'];
                const negativeStyles = ['disrespectful', 'clingy', 'distant', 'jealous'];
                
                const positiveCount = data.communicationStyles.filter(style => positiveStyles.includes(style)).length;
                const negativeCount = data.communicationStyles.filter(style => negativeStyles.includes(style)).length;
                
                compatibilityScore = 50 + (positiveCount * 10) - (negativeCount * 15);
            }
            
            // Calculate red flag score based on red flags
            if (data.redFlags && data.redFlags.length > 0) {
                const redFlagWeights = {
                    'ghosting': 25,
                    'hotCold': 20,
                    'loveBombing': 30,
                    'controlling': 35,
                    'disrespectful': 30,
                    'inconsistent': 15,
                    'jealous': 25,
                    'avoidant': 20,
                    'gaslighting': 40,
                    'breadcrumbing': 20
                };
                
                redFlagScore = data.redFlags.reduce((score, flag) => score + (redFlagWeights[flag] || 20), 0);
                redFlagScore = Math.min(100, redFlagScore);
            }
            
            // Generate dynamic quote based on situation
            const quotes = [
                "In the dance of uncertainty, every message is a step toward clarity.",
                "Sometimes the best relationships start with a simple 'hello' and grow with every reply.",
                "Love isn't always loud; sometimes it's in the quiet moments between messages.",
                "The space between 'sent' and 'delivered' holds more emotion than we realize.",
                "Every emoji, every late-night text, every 'good morning' builds a bridge between two hearts."
            ];
            
            // Generate dynamic brief statement
            let briefStatement = "Your situationship shows ";
            if (likeLevel >= 8) briefStatement += "strong romantic potential with deep emotional connection.";
            else if (likeLevel >= 6) briefStatement += "growing interest with some uncertainty about the future.";
            else if (likeLevel >= 4) briefStatement += "casual interest with room for deeper connection.";
            else briefStatement += "early stages of getting to know each other.";
            
            if (!hasChatLogs) briefStatement += " Note: Limited chat data provided for analysis.";
            
            // Generate dynamic analysis based on provided data
            const analysis = [];
            if (data.pros.length > 0) analysis.push(`You see ${data.pros.length} positive qualities in this person`);
            if (data.cons.length > 0) analysis.push(`You've identified ${data.cons.length} areas of concern`);
            if (data.communicationStyles.length > 0) analysis.push(`Communication style includes: ${data.communicationStyles.join(', ')}`);
            if (likeLevel >= 7) analysis.push("High level of interest indicates strong romantic potential");
            if (spiceLevel >= 7) analysis.push("High spice level suggests mutual attraction and chemistry");
            
            if (analysis.length === 0) {
                analysis.push("Limited data provided for detailed analysis");
                analysis.push("Consider sharing more chat logs for better insights");
            }
            
            // Generate future prediction based on data
            let futurePrediction = "Based on the current patterns, ";
            if (redFlagScore > 70) {
                futurePrediction += "this situationship may not be healthy long-term. Consider addressing the red flags or moving on.";
            } else if (compatibilityScore > 80 && likeLevel >= 7) {
                futurePrediction += "this has strong potential for a committed relationship if both parties are ready.";
            } else if (compatibilityScore > 60 && likeLevel >= 5) {
                futurePrediction += "this could develop into something more serious with better communication and clarity.";
            } else if (likeLevel <= 3) {
                futurePrediction += "this appears to be a casual connection that may not develop further.";
            } else {
                futurePrediction += "this situationship's future depends on improved communication and mutual understanding.";
            }
            
            // Generate dynamic advice
            const advice = [];
            if (redFlagScore > 50) advice.push("üö© Address the red flags before investing more emotionally");
            if (likeLevel >= 8) advice.push("Consider having a conversation about defining the relationship");
            if (likeLevel <= 3) advice.push("Take time to get to know each other better before making decisions");
            if (data.cons.length > data.pros.length) advice.push("Address the concerns you've identified before moving forward");
            if (compatibilityScore < 40) advice.push("Consider if your communication styles are truly compatible");
            if (!hasChatLogs) advice.push("Share more chat logs for a more accurate analysis");
            advice.push("Trust your instincts and communicate openly about your feelings");
            
            // Ensure advice is always an array
            if (advice.length === 0) {
                advice.push("Focus on open communication and mutual understanding");
            }
            
            return {
                healthyLevel: Math.min(100, Math.max(0, healthyLevel)),
                spicyLevel: Math.min(100, Math.max(0, spicyLevel)),
                communicationLevel: Math.min(100, Math.max(0, communicationLevel)),
                compatibilityScore: Math.min(100, Math.max(0, compatibilityScore)),
                redFlagScore: Math.min(100, Math.max(0, redFlagScore)),
                futurePrediction: futurePrediction,
                quote: quotes[Math.floor(Math.random() * quotes.length)],
                briefStatement: briefStatement,
                detailedAnalysis: analysis,
                keyMoments: hasChatLogs ? ["\"First meaningful conversation\" - Based on chat analysis", "\"Moment of vulnerability\" - From chat patterns"] : ["No chat logs provided for moment analysis"],
                funnyMoments: hasChatLogs ? ["\"Playful exchange\" - From chat content", "\"Inside joke moment\" - Based on conversation"] : ["No chat logs provided for moment analysis"],
                spicyMoments: hasChatLogs ? ["\"Flirty moment\" - From chat analysis", "\"Romantic exchange\" - Based on conversation"] : ["No chat logs provided for moment analysis"],
                bestFlirtyMoments: hasChatLogs ? ["\"Sweet moment\" - From chat content", "\"Romantic exchange\" - Based on conversation"] : ["No chat logs provided for moment analysis"],
                emotionalMoments: hasChatLogs ? ["\"Deep conversation\" - From chat analysis", "\"Vulnerable moment\" - Based on conversation"] : ["No chat logs provided for moment analysis"],
                conflictMoments: hasChatLogs ? ["\"Misunderstanding\" - From chat analysis", "\"Serious discussion\" - Based on conversation"] : ["No chat logs provided for moment analysis"],
                advice: advice
            };
        }

        function displayResults(analysis) {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <h2 style="text-align: center; color: #ff4757; margin-bottom: 30px;">üîÆ Your Situationship Analysis üîÆ</h2>
                
                <div class="metric-card">
                    <div class="metric-title">üíö Healthy Levels</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${analysis.healthyLevel}%"></div>
                    </div>
                    <p style="text-align: center; font-weight: bold; color: #ff4757;">${analysis.healthyLevel}%</p>
                </div>

                <div class="metric-card">
                    <div class="metric-title">üå∂Ô∏è Spicy Levels</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${analysis.spicyLevel}%"></div>
                    </div>
                    <p style="text-align: center; font-weight: bold; color: #ff4757;">${analysis.spicyLevel}%</p>
                </div>

                <div class="metric-card">
                    <div class="metric-title">üí¨ Communication Flow</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${analysis.communicationLevel}%"></div>
                    </div>
                    <p style="text-align: center; font-weight: bold; color: #ff4757;">${analysis.communicationLevel}%</p>
                </div>

                <div class="metric-card">
                    <div class="metric-title">üíØ Compatibility Score</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${analysis.compatibilityScore}%"></div>
                    </div>
                    <p style="text-align: center; font-weight: bold; color: #ff4757;">${analysis.compatibilityScore}%</p>
                </div>

                <div class="metric-card">
                    <div class="metric-title">üö© Red Flag Score</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${analysis.redFlagScore}%; background: ${analysis.redFlagScore > 50 ? 'linear-gradient(90deg, #ff4757, #ff3838)' : 'linear-gradient(90deg, #ff4757, #ff6b6b)'}"></div>
                    </div>
                    <p style="text-align: center; font-weight: bold; color: #ff4757;">${analysis.redFlagScore}%</p>
                </div>

                <div class="quote-section">
                    <h4>üíù Romantic Quote</h4>
                    <p>"${analysis.quote}"</p>
                </div>

                <div class="analysis-section">
                    <h4>üîÆ Future Prediction</h4>
                    <div class="analysis-content" style="background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-left: 4px solid #ff4757; padding: 20px; border-radius: 10px;">
                        <p style="font-weight: 600; color: #333; margin: 0;">${analysis.futurePrediction}</p>
                    </div>
                </div>

                <div class="analysis-section">
                    <h4>üí≠ Brief Statement</h4>
                    <div class="analysis-content">
                        ${analysis.briefStatement}
                    </div>
                </div>

                <div class="analysis-section">
                    <h4>üìã Detailed Analysis</h4>
                    <div class="analysis-content">
                        <ul style="list-style: none; padding: 0;">
                            ${analysis.detailedAnalysis.map(point => `<li style="margin: 10px 0; padding-left: 20px; position: relative;">
                                <span style="position: absolute; left: 0; color: #ff4757;">üíï</span>
                                ${point}
                            </li>`).join('')}
                        </ul>
                    </div>
                </div>

                ${analysis.keyMoments && analysis.keyMoments.length > 0 ? `
                <div class="analysis-section">
                    <h4>üîë Key Moments</h4>
                    <div class="analysis-content">
                        <ul style="list-style: none; padding: 0;">
                            ${analysis.keyMoments.map(momentObj =>
                                (typeof momentObj === 'object' && momentObj !== null) ?
                                    `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üîë</span>
                                        ${momentObj.moment ? `<div style="font-weight: bold; color: #ff4757; margin-bottom: 5px;">${momentObj.moment}</div>` : ''}
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj.quote || ''}</div>
                                        ${momentObj.analysis ? `<div style="margin-top: 8px; color: #444;"><em>Analysis:</em> ${momentObj.analysis}</div>` : ''}
                                    </li>`
                                : `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üîë</span>
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj}</div>
                                   </li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
                ` : ''}

                ${analysis.funnyMoments && analysis.funnyMoments.length > 0 ? `
                <div class="analysis-section">
                    <h4>üòÇ Funny Moments</h4>
                    <div class="analysis-content">
                        <ul style="list-style: none; padding: 0;">
                            ${analysis.funnyMoments.map(momentObj =>
                                (typeof momentObj === 'object' && momentObj !== null) ?
                                    `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üòÇ</span>
                                        ${momentObj.moment ? `<div style="font-weight: bold; color: #ff4757; margin-bottom: 5px;">${momentObj.moment}</div>` : ''}
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj.quote || ''}</div>
                                        ${momentObj.analysis ? `<div style="margin-top: 8px; color: #444;"><em>Analysis:</em> ${momentObj.analysis}</div>` : ''}
                                    </li>`
                                : `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üòÇ</span>
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj}</div>
                                   </li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
                ` : ''}

                ${analysis.spicyMoments && analysis.spicyMoments.length > 0 ? `
                <div class="analysis-section">
                    <h4>üå∂Ô∏è Spicy Moments</h4>
                    <div class="analysis-content">
                        <ul style="list-style: none; padding: 0;">
                            ${analysis.spicyMoments.map(momentObj =>
                                (typeof momentObj === 'object' && momentObj !== null) ?
                                    `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üå∂Ô∏è</span>
                                        ${momentObj.moment ? `<div style="font-weight: bold; color: #ff4757; margin-bottom: 5px;">${momentObj.moment}</div>` : ''}
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj.quote || ''}</div>
                                        ${momentObj.analysis ? `<div style="margin-top: 8px; color: #444;"><em>Analysis:</em> ${momentObj.analysis}</div>` : ''}
                                    </li>`
                                : `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üå∂Ô∏è</span>
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj}</div>
                                   </li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
                ` : ''}

                ${analysis.bestFlirtyMoments && analysis.bestFlirtyMoments.length > 0 ? `
                <div class="analysis-section">
                    <h4>üíã Best Flirty Moments</h4>
                    <div class="analysis-content">
                        <ul style="list-style: none; padding: 0;">
                            ${analysis.bestFlirtyMoments.map(momentObj =>
                                (typeof momentObj === 'object' && momentObj !== null) ?
                                    `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üíã</span>
                                        ${momentObj.moment ? `<div style="font-weight: bold; color: #ff4757; margin-bottom: 5px;">${momentObj.moment}</div>` : ''}
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj.quote || ''}</div>
                                        ${momentObj.analysis ? `<div style="margin-top: 8px; color: #444;"><em>Analysis:</em> ${momentObj.analysis}</div>` : ''}
                                    </li>`
                                : `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üíã</span>
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj}</div>
                                   </li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
                ` : ''}

                ${analysis.emotionalMoments && analysis.emotionalMoments.length > 0 ? `
                <div class="analysis-section">
                    <h4>üíù Emotional Moments</h4>
                    <div class="analysis-content">
                        <ul style="list-style: none; padding: 0;">
                            ${analysis.emotionalMoments.map(momentObj =>
                                (typeof momentObj === 'object' && momentObj !== null) ?
                                    `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üíù</span>
                                        ${momentObj.moment ? `<div style="font-weight: bold; color: #ff4757; margin-bottom: 5px;">${momentObj.moment}</div>` : ''}
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj.quote || ''}</div>
                                        ${momentObj.analysis ? `<div style="margin-top: 8px; color: #444;"><em>Analysis:</em> ${momentObj.analysis}</div>` : ''}
                                    </li>`
                                : `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">üíù</span>
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj}</div>
                                   </li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
                ` : ''}

                ${analysis.conflictMoments && analysis.conflictMoments.length > 0 ? `
                <div class="analysis-section">
                    <h4>‚öîÔ∏è Conflict Moments</h4>
                    <div class="analysis-content">
                        <ul style="list-style: none; padding: 0;">
                            ${analysis.conflictMoments.map(momentObj =>
                                (typeof momentObj === 'object' && momentObj !== null) ?
                                    `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">‚öîÔ∏è</span>
                                        ${momentObj.moment ? `<div style="font-weight: bold; color: #ff4757; margin-bottom: 5px;">${momentObj.moment}</div>` : ''}
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj.quote || ''}</div>
                                        ${momentObj.analysis ? `<div style="margin-top: 8px; color: #444;"><em>Analysis:</em> ${momentObj.analysis}</div>` : ''}
                                    </li>`
                                : `<li style="margin: 15px 0; padding: 15px; position: relative; background: linear-gradient(135deg, #fff5f5, #ffe8e8); border-radius: 10px; border-left: 4px solid #ff4757;">
                                        <span style="position: absolute; left: -10px; top: 15px; color: #ff4757; background: white; padding: 5px; border-radius: 50%; font-size: 14px;">‚öîÔ∏è</span>
                                        <div style="font-style: italic; color: #666; margin-bottom: 5px;">üí¨ Chat Quote:</div>
                                        <div style="font-weight: 600; color: #333; white-space: pre-line;">${momentObj}</div>
                                   </li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
                ` : ''}

                <div class="advice-section">
                    <h4>üí° Advice & Next Steps</h4>
                    <div class="advice-list">
                        ${Array.isArray(analysis.advice) ? 
                            analysis.advice.map(advice => `<li>
                                <span style="color: #ff4757;">üí°</span>
                                ${advice}
                            </li>`).join('') :
                            `<li>
                                <span style="color: #ff4757;">üí°</span>
                                ${analysis.advice}
                            </li>`
                        }
                    </div>
                </div>
            `;
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize
        createHearts();
    </script>
</body>
</html> 